# Проект 1337b04rd - План Задач

## Архитектура и база

###
- [x] Прочитать и проанализировать требования проекта
- [x] Составить список сущностей и их атрибутов (Post, Comment, Session, User, Avatar и др.)
- [ ] Нарисовать ERD (Entity Relationship Diagram) с учётом связей и ограничений

###
- [ ] Разработать структуру проекта согласно Hexagonal Architecture
  - [x] cmd/1337b04rd/ — точка входа
  - [ ] internal/domain/ — бизнес-логика и сущности
  - [ ] internal/service/ — юзкейсы и правила
  - [ ] internal/repository/ — интерфейсы и SQL-реализация
  - [ ] internal/handler/ — HTTP-обработчики
  - [ ] internal/adapter/ — работа с S3, API и др.

###
- [ ] Настроить PostgreSQL, написать и применить миграции через sqlc или вручную
- [ ] Настроить S3 (MinIO) локально, создать 2 бакета (например: posts, comments)
- [ ] Создать go-модуль, настроить базовые зависимости (только стандартная библиотека и PostgreSQL-драйвер)

## Основная бизнес-логика
###
- [ ] Реализовать структуру Post, Comment, UserSession, Reply
- [ ] Интерфейсы в domain: PostRepository, ImageStorage, SessionManager, AvatarService

###
- [ ] Реализовать бизнес-логику создания поста
  - [ ] Валидация входных данных
  - [ ] Обработка изображений (проверка формата и размера)
  - [ ] Загрузка в S3 и сохранение URL
  - [ ] Генерация ID, времени создания и сохранение в БД

###
- [ ] Получение и кэширование списка Rick and Morty персонажей (с именами и изображениями)
- [ ] Назначение случайного персонажа при первой сессии пользователя (по cookie)
- [ ] Обновление имени пользователя при его смене
- [ ] Добавление комментариев (в том числе ответов на другие комментарии)
- [ ] Создание механизма удаления/архивации постов по таймеру

## Инфраструктура и UI-обработка
###
- [ ] Работа с HTML-шаблонами:
  - [ ] catalog.html, archive.html — отображение превью тем
  - [ ] post.html, archive-post.html — полная тема с комментариями
  - [ ] create-post.html — форма создания темы
  - [ ] error.html — обработка ошибок

###
- [ ] Настроить HTTP-маршруты и REST API:
  - [ ] GET /catalog
  - [ ] GET /archive
  - [ ] GET /post/:id
  - [ ] POST /create
  - [ ] POST /comment
- [ ] Подключение шаблонов к обработчикам
- [ ] Сессии через cookie: генерация, проверка, хранение данных

###
- [ ] Обработка логики архивных постов (нельзя комментировать)
- [ ] Автоматический переход постов в архив через time.Ticker
- [ ] Логгирование всех действий (slog.Info, slog.Error, slog.Debug)
- [ ] Логгирование с контекстом (ID, пути, статус и пр.)

## Тесты, багфиксы и финал
###
- [ ] Написание unit-тестов:
  - [ ] Создание постов/комментариев
  - [ ] Назначение аватаров
  - [ ] Сессии и cookie
  - [ ] Интеграция с S3 и Rick and Morty API (через мок)
- [ ] Проверка покрытия тестами: минимум 20%

###
- [ ] Обработка всех возможных ошибок
  - [ ] Ошибки базы данных
  - [ ] Ошибки при загрузке изображений
  - [ ] Ошибки при рендере шаблонов

###
- [ ] Тестирование всего функционала вручную
- [ ] Проверка на соответствие требованиям (компиляция, структура, ошибки)
- [ ] Добавить флаг --help и описание CLI
- [ ] Финальный рефакторинг и документация
- [ ] Опционально: выбор и добавление лицензии (MIT, GPL и пр.)

## Итого
Полноценный backend с:
- Hexagonal Architecture
- PostgreSQL + S3 интеграцией
- REST API + шаблонами
- Сессиями, аватарами и куки
- Удалением по таймеру
- Логгированием и тестами